!function(){var e={id:function(e){return document.getElementById(e)},elements:function(e){return document.querySelectorAll(".".concat(e))},remove:function(e){document.getElementById(e).parentNode.removeChild(document.getElementById(e))},classExists:function(e){return e.every((function(e){return document.getElementsByClassName(e).length>0}))},anyClassExists:function(e){return e.some((function(e){return document.getElementsByClassName(e).length>0}))}},n={notesChannel:__channel__,addressedChannel:__channel__,addressedId:__channel__.slice(0,8)+__channel__.slice(-2),thread:__id__,sockets:[],messages:{}},t=n.addressedId,c=n.messages,a=n.sockets,s=e.id("message-list"),r=function(e,n){return function(r){for(var o=n.getElementsByTagName("li"),l=0;l<o.length;++l)o[l].innerHTML=o[l].innerHTML.replace("<b>","").replace("</b>","");var d=r.target;d.innerHTML="<b>".concat(d.innerHTML,"</b>"),e,t=function(e){return e.slice(0,8)+e.slice(-2)}(e),localStorage.getItem(t)&&c[t].push(JSON.parse(localStorage.getItem(t))),a[t]?c[t].forEach((function(e){!function(e){var n=document.createElement("li");n.innerHTML="<b>".concat(e.sender,":&nbsp;</b>").concat(e.message),s.appendChild(n)}(e)})):p()}},o=n.addressedChannel,l=n.addressedId,d=n.notesChannel,i=n.sockets,u=n.thread,m=n.messages,h=e.id("message-list"),g=function(e){return e.slice(0,8)+e.slice(-2)},f="ws://".concat(window.location.host,"/chat/ping/?channel="),p=function(){try{i[l]=new WebSocket(f+o),i[l].onerror=function(e){console.log(e)}}catch(e){return console.log(e),!1}return i[l].onmessage=function(e){try{var n=JSON.parse(e.data);m[l]?m[l].push(n):m[l]=[n],localStorage.setItem(l,JSON.stringify(m[l])),t=n,(c=document.createElement("li")).innerHTML="<b>".concat(t.sender,":&nbsp;</b>").concat(t.message),h.appendChild(c)}catch(e){console.log(e)}var t,c},e.id("messenger").addEventListener("keyup",(function(e){"Enter"===e.key&&(i[l].send(JSON.stringify({message:e.target.value})),e.target.value="")})),!0};p()&&e.id("channels")&&fetch("/secrets/id/".concat(u,"/channels")).then((function(e){return e.json()})).then((function(n){var t=e.id("channels box");n.channels.forEach((function(e){var n=document.createElement("li");e===d&&(n.style="color: red"),n.appendChild(document.createTextNode(g(e))),n.addEventListener("click",r(e,t),!1),t.appendChild(n)})),n.readableChannels.forEach((function(e){var n=document.createElement("li");e===d&&(n.style="color: red"),n.appendChild(document.createTextNode(g(e))),n.addEventListener("click",r(e,t),!1),t.appendChild(n)})),console.log("channels ".concat(n))}))}();
//# sourceMappingURL=setup.js.map
